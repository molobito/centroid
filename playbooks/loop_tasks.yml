- name: Assume IAM role
  shell: eval $(aws sts assume-role --role-arn {{ item.role }} --role-session-name ansible-session | jq -r '.Credentials | "export AWS_ACCESS_KEY_ID=\(.AccessKeyId)\nexport AWS_SECRET_ACCESS_KEY=\(.SecretAccessKey)\nexport AWS_SESSION_TOKEN=\(.SessionToken)\n"')
- name: Run command
  command: aws sts get-caller-identity
  register: my_output 
- name: Display output
  debug:
    var: my_output
